(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[16],{

/***/ "./node_modules/@atlaskit/media-store/dist/es2015/utils/hashing/workerHasher.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/@atlaskit/media-store/dist/es2015/utils/hashing/workerHasher.js ***!
  \**************************************************************************************/
/*! exports provided: WorkerHasher */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"WorkerHasher\", function() { return WorkerHasher; });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! uuid */ \"./node_modules/uuid/index.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(uuid__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var rusha__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rusha */ \"./node_modules/rusha/dist/rusha.js\");\n/* harmony import */ var rusha__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(rusha__WEBPACK_IMPORTED_MODULE_1__);\n/* tslint:disable:no-var-requires */\n\n\nvar WorkerHasher = /** @class */ (function () {\n    function WorkerHasher(numOfWorkers) {\n        this.workers = [];\n        this.jobs = {};\n        for (var i = 0; i < numOfWorkers; ++i) {\n            this.workers.push(this.createWorker());\n        }\n    }\n    WorkerHasher.prototype.hash = function (chunk) {\n        return this.calculateHashInWorker(chunk);\n    };\n    WorkerHasher.prototype.createWorker = function () {\n        var _this = this;\n        var worker = rusha__WEBPACK_IMPORTED_MODULE_1__[\"createWorker\"]();\n        var hasherWorker = { worker: worker, activeJobs: 0 };\n        worker.addEventListener('message', function (event) {\n            _this.handleWorkerMessage(event, hasherWorker);\n        });\n        return hasherWorker;\n    };\n    WorkerHasher.prototype.handleWorkerMessage = function (event, hasherWorker) {\n        var id = event.data.id;\n        if (this.jobs[id]) {\n            var _a = this.jobs[id], resolve = _a.resolve, reject = _a.reject;\n            delete this.jobs[id];\n            hasherWorker.activeJobs--;\n            if (event.data.error) {\n                // TODO previously we were just calling it again.\n                // this.calculateHashInWorker(chunk);\n                reject(event.data.error);\n            }\n            else {\n                resolve(event.data.hash);\n            }\n        }\n    };\n    WorkerHasher.prototype.calculateHashInWorker = function (blob) {\n        var _this = this;\n        var jobId = uuid__WEBPACK_IMPORTED_MODULE_0__[\"v4\"]();\n        return new Promise(function (resolve, reject) {\n            _this.jobs[jobId] = { resolve: resolve, reject: reject };\n            var worker = _this.getMostRelaxedWorker();\n            _this.dispatch(jobId, worker, blob);\n        });\n    };\n    WorkerHasher.prototype.dispatch = function (jobId, hasherWorker, chunkBlob) {\n        hasherWorker.activeJobs++;\n        var worker = hasherWorker.worker;\n        /*\n         * postMessage() with chunk blob in Safari results in the error\n         * \"Failed to load resource: The operation could not be completed. (WebKitBlobResource error 1.)\"\n         *\n         * To prevent it, we read the data from the blob using FileReader and pass it via postMessage to the worker.\n         */\n        if (navigator.userAgent.indexOf('Safari') > -1 &&\n            navigator.userAgent.indexOf('Chrome') === -1) {\n            var rd_1 = new FileReader();\n            rd_1.onload = function () {\n                worker.postMessage({ id: jobId, data: rd_1.result });\n            };\n            rd_1.readAsBinaryString(chunkBlob);\n            return;\n        }\n        worker.postMessage({ id: jobId, data: chunkBlob });\n    };\n    WorkerHasher.prototype.getMostRelaxedWorker = function () {\n        return this.workers.reduce(function (current, next) {\n            if (next.activeJobs < current.activeJobs) {\n                return next;\n            }\n            return current;\n        }, this.workers[0]);\n    };\n    return WorkerHasher;\n}());\n\n//# sourceMappingURL=workerHasher.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGF0bGFza2l0L21lZGlhLXN0b3JlL2Rpc3QvZXMyMDE1L3V0aWxzL2hhc2hpbmcvd29ya2VySGFzaGVyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BhdGxhc2tpdC9tZWRpYS1zdG9yZS9kaXN0L2VzMjAxNS91dGlscy9oYXNoaW5nL3dvcmtlckhhc2hlci5qcz9jNjM3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qIHRzbGludDpkaXNhYmxlOm5vLXZhci1yZXF1aXJlcyAqL1xuaW1wb3J0ICogYXMgdXVpZCBmcm9tICd1dWlkJztcbmltcG9ydCAqIGFzIFJ1c2hhIGZyb20gJ3J1c2hhJztcbnZhciBXb3JrZXJIYXNoZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2VySGFzaGVyKG51bU9mV29ya2Vycykge1xuICAgICAgICB0aGlzLndvcmtlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5qb2JzID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtT2ZXb3JrZXJzOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMud29ya2Vycy5wdXNoKHRoaXMuY3JlYXRlV29ya2VyKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFdvcmtlckhhc2hlci5wcm90b3R5cGUuaGFzaCA9IGZ1bmN0aW9uIChjaHVuaykge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVIYXNoSW5Xb3JrZXIoY2h1bmspO1xuICAgIH07XG4gICAgV29ya2VySGFzaGVyLnByb3RvdHlwZS5jcmVhdGVXb3JrZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB3b3JrZXIgPSBSdXNoYS5jcmVhdGVXb3JrZXIoKTtcbiAgICAgICAgdmFyIGhhc2hlcldvcmtlciA9IHsgd29ya2VyOiB3b3JrZXIsIGFjdGl2ZUpvYnM6IDAgfTtcbiAgICAgICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVdvcmtlck1lc3NhZ2UoZXZlbnQsIGhhc2hlcldvcmtlcik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaGFzaGVyV29ya2VyO1xuICAgIH07XG4gICAgV29ya2VySGFzaGVyLnByb3RvdHlwZS5oYW5kbGVXb3JrZXJNZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50LCBoYXNoZXJXb3JrZXIpIHtcbiAgICAgICAgdmFyIGlkID0gZXZlbnQuZGF0YS5pZDtcbiAgICAgICAgaWYgKHRoaXMuam9ic1tpZF0pIHtcbiAgICAgICAgICAgIHZhciBfYSA9IHRoaXMuam9ic1tpZF0sIHJlc29sdmUgPSBfYS5yZXNvbHZlLCByZWplY3QgPSBfYS5yZWplY3Q7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5qb2JzW2lkXTtcbiAgICAgICAgICAgIGhhc2hlcldvcmtlci5hY3RpdmVKb2JzLS07XG4gICAgICAgICAgICBpZiAoZXZlbnQuZGF0YS5lcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gcHJldmlvdXNseSB3ZSB3ZXJlIGp1c3QgY2FsbGluZyBpdCBhZ2Fpbi5cbiAgICAgICAgICAgICAgICAvLyB0aGlzLmNhbGN1bGF0ZUhhc2hJbldvcmtlcihjaHVuayk7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LmRhdGEuZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShldmVudC5kYXRhLmhhc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBXb3JrZXJIYXNoZXIucHJvdG90eXBlLmNhbGN1bGF0ZUhhc2hJbldvcmtlciA9IGZ1bmN0aW9uIChibG9iKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBqb2JJZCA9IHV1aWQudjQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIF90aGlzLmpvYnNbam9iSWRdID0geyByZXNvbHZlOiByZXNvbHZlLCByZWplY3Q6IHJlamVjdCB9O1xuICAgICAgICAgICAgdmFyIHdvcmtlciA9IF90aGlzLmdldE1vc3RSZWxheGVkV29ya2VyKCk7XG4gICAgICAgICAgICBfdGhpcy5kaXNwYXRjaChqb2JJZCwgd29ya2VyLCBibG9iKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBXb3JrZXJIYXNoZXIucHJvdG90eXBlLmRpc3BhdGNoID0gZnVuY3Rpb24gKGpvYklkLCBoYXNoZXJXb3JrZXIsIGNodW5rQmxvYikge1xuICAgICAgICBoYXNoZXJXb3JrZXIuYWN0aXZlSm9icysrO1xuICAgICAgICB2YXIgd29ya2VyID0gaGFzaGVyV29ya2VyLndvcmtlcjtcbiAgICAgICAgLypcbiAgICAgICAgICogcG9zdE1lc3NhZ2UoKSB3aXRoIGNodW5rIGJsb2IgaW4gU2FmYXJpIHJlc3VsdHMgaW4gdGhlIGVycm9yXG4gICAgICAgICAqIFwiRmFpbGVkIHRvIGxvYWQgcmVzb3VyY2U6IFRoZSBvcGVyYXRpb24gY291bGQgbm90IGJlIGNvbXBsZXRlZC4gKFdlYktpdEJsb2JSZXNvdXJjZSBlcnJvciAxLilcIlxuICAgICAgICAgKlxuICAgICAgICAgKiBUbyBwcmV2ZW50IGl0LCB3ZSByZWFkIHRoZSBkYXRhIGZyb20gdGhlIGJsb2IgdXNpbmcgRmlsZVJlYWRlciBhbmQgcGFzcyBpdCB2aWEgcG9zdE1lc3NhZ2UgdG8gdGhlIHdvcmtlci5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1NhZmFyaScpID4gLTEgJiZcbiAgICAgICAgICAgIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPT09IC0xKSB7XG4gICAgICAgICAgICB2YXIgcmRfMSA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICByZF8xLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoeyBpZDogam9iSWQsIGRhdGE6IHJkXzEucmVzdWx0IH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJkXzEucmVhZEFzQmluYXJ5U3RyaW5nKGNodW5rQmxvYik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGpvYklkLCBkYXRhOiBjaHVua0Jsb2IgfSk7XG4gICAgfTtcbiAgICBXb3JrZXJIYXNoZXIucHJvdG90eXBlLmdldE1vc3RSZWxheGVkV29ya2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53b3JrZXJzLnJlZHVjZShmdW5jdGlvbiAoY3VycmVudCwgbmV4dCkge1xuICAgICAgICAgICAgaWYgKG5leHQuYWN0aXZlSm9icyA8IGN1cnJlbnQuYWN0aXZlSm9icykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgICAgIH0sIHRoaXMud29ya2Vyc1swXSk7XG4gICAgfTtcbiAgICByZXR1cm4gV29ya2VySGFzaGVyO1xufSgpKTtcbmV4cG9ydCB7IFdvcmtlckhhc2hlciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d29ya2VySGFzaGVyLmpzLm1hcCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/@atlaskit/media-store/dist/es2015/utils/hashing/workerHasher.js\n");

/***/ })

}]);